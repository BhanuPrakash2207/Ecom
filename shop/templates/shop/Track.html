{% extends 'shop/base.html' %}
{% block title %} Track{% endblock %}
{% block body %}
<div class="container">
<div class="col my-4">
    <h4>Please provide your details to track your orders:</h4>
    <form action="#" id="trackerForm" method="POST">{% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="ord_id">Order_ID</label>
                <input type="text" name="ord_id" id="ord_id" class="form-control" placeholder="ord_id">
            </div>
            <div class="form-group col-md-6">
                <label for="email">Email</label>
                <input type="email" name="email" id="email" class="form-control" placeholder="email">
            </div>

            <button type="submit" class="btn btn-primary">Track Order</button>
        </div>
</div>
<div class="col-my-4">
    <h5>Your Order Status:</h5>
    <div class="my-4">
        <ul class="list-group" id="items">Enter your order Id and Email and click Track Order to find details about your
            order!
        </ul>
    </div>
</div>
    </div>
{% endblock %}
{% block JS %}
<script>
    $('#trackerForm').submit(function(event){
    $('#items').empty();
    var formdata={
    'ord_id':$('input[name=ord_id]').val(),
    'email':$('input[name=email]').val(),
    'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val()
    };
    console.log(ord_id);
    console.log(email);
    $.ajax({
    type:'POST',
    url: '/shop/track/',
    data:formdata,
    encode:true
    })
    .done(function(data){
    console.log(data);
    updates=JSON.parse(data);
    if(updates.length>0 & updates!={}){
    for(i=0;i<updates.length;i++){
    let text=updates[i]['text'];
    let time=updates[i]['time'];
    mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
                    ${text}
                    <span class="badge badge-primary badge-pill">${time}</span>
                </li>`
                    $('#items').append(mystr);
                }
            } else {
            	mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
                    Sorry, We are not able to fetch this order id and email. Make sure to type correct order Id and email</li>`
            	$('#items').append(mystr);
            }
        });
    event.preventDefault();
    });



</script>
{% endblock %}